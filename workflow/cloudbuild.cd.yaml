steps:
  - name: 'golang:1.16.12-alpine'
    entrypoint: 'go'
    dir: src
    args: ['vet', './...']

  - name: 'golang:1.16.12-alpine'
    entrypoint: 'go'
    dir: src
    args: ['test', '-v', './...']

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk:alpine'
    entrypoint: '/bin/ash'
    args:
      [
        '-c',
        'gcloud secrets versions access latest --secret=api-server-secrets > secrets.yaml',
      ]

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk:alpine'
    entrypoint: 'gcloud'
    args: ['app', 'deploy', '--quiet']

options:
  env:
    - 'CGO_ENABLED=0'
